---
title: "analysis"
author: "Elen Ghalechyan, Section A"
date: "2024-11-29"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(ggplot2)
library(corrplot)
library(lubridate)
library(GGally)
library(knitr)
library(ggcorrplot)
library(FactoMineR)
library(factoextra)
library(pheatmap)
```

```{r}
data_cleaned <- read.csv("cleaned_water_data.csv")
coordinates <- read.csv("coordinates.csv")
```

Hypothesis 1: There is a spatial correlation between water quality indicators (e.g., BOD5, COD) and the geographic location (X, Y coordinates) of the sampling stations.






**Exploratory Data Analysis (EDA)**

```{r}
# Univariate Analysis - Histogram of Dissolved Oxygen
ggplot(data_cleaned, aes(x = Dissolved_Oxygen)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Distribution of Dissolved Oxygen", x = "Dissolved Oxygen (mg/L)", y = "Frequency")
```
```{r}
# Temporal Trends - Dissolved Oxygen Over Time
ggplot(data_cleaned, aes(x = Datetime, y = Dissolved_Oxygen)) +
  geom_line(color = "blue") +
  labs(title = "Dissolved Oxygen Over Time", x = "Date", y = "Dissolved Oxygen (mg/L)")
```


**Outlier Detection**

**Time Series Analysis**

```{r}
# Time Series for BOD5 and COD
ggplot(data_cleaned, aes(x = Datetime)) +
  geom_line(aes(y = BOD5, color = "BOD5")) +
  geom_line(aes(y = COD, color = "COD")) +
  labs(title = "Temporal Trends of BOD5 and COD", x = "Datetime", y = "Concentration (mg/L)") +
  scale_color_manual(values = c("BOD5" = "green", "COD" = "orange"))
```

**Correlation Analysis**

```{r}
# Select numeric columns
numeric_cols <- data_cleaned %>%
  select(where(is.numeric))

# Compute correlation matrix
cor_matrix <- cor(numeric_cols, use = "complete.obs")
pairs(numeric_cols[, 1:8], main = "Scatterplot Matrix for Selected Variables")
```

**Principal Component Analysis (PCA)**

```{r}
numeric_data <- data_cleaned %>%
  select(where(is.numeric))
```

```{r}
numeric_data <- numeric_data %>%
  select(where(~ all(!is.na(.)))) 
```

```{r}
numeric_data_scaled <- scale(numeric_data)
```

```{r}
data_pca = prcomp(x = numeric_data_scaled, center = T, scale. = T)
summary(data_pca)
```

```{r}
pheatmap(numeric_data_scaled, cluster_rows = T, cluster_cols = T)
```

```{r}
fviz_screeplot(data_pca, addlabels = T)
```

```{r}
fviz_pca_biplot(data_pca, axes = c(1, 2), geom = c("point", "text"), label = "var")
```


```{r}
fviz_pca_var(data_pca, col.var = "black") 
```

**Clustering**

```{r}
# Step 1: Prepare data for clustering
# Use scaled numeric data from the PCA section for clustering
data_for_clustering <- numeric_data_scaled


# Step 2: K-means Clustering
set.seed(123)  # For reproducibility

# Determine the optimal number of clusters using the Elbow Method
wss <- sapply(1:10, function(k) {
  kmeans(data_for_clustering, centers = k, nstart = 25)$tot.withinss
})

# Plot the Elbow Method
plot(1:10, wss, type = "b", pch = 19, frame = FALSE,
     xlab = "Number of Clusters",
     ylab = "Total Within-Cluster Sum of Squares",
     main = "Elbow Method for Optimal Clusters")

# Apply K-means clustering with an optimal number of clusters (e.g., 3)
kmeans_result <- kmeans(data_for_clustering, centers = 3, nstart = 25)

# Add cluster labels to the original data
data_cleaned$Cluster <- as.factor(kmeans_result$cluster)



```
```{r}
# Compute dissimilarity matrix
dist_matrix <- dist(data_for_clustering, method = "euclidean")

# Perform hierarchical clustering
hclust_result <- hclust(dist_matrix, method="complete")

# Plot the dendrogram
plot(hclust_result, labels = FALSE, hang = -1,
     main = "Dendrogram of Hierarchical Clustering",
     xlab = "Samples",
     ylab = "Height")

# Cut the dendrogram into clusters
hclust_clusters <- cutree(hclust_result, k = 3)

# Add hierarchical clustering labels to the original data
data_cleaned$HCluster <- as.factor(hclust_clusters)

# Visualize heatmap with hierarchical clustering
pheatmap(data_for_clustering, cluster_rows = hclust_result, cluster_cols = FALSE,
         main = "Heatmap with Hierarchical Clustering")
```




**Geospatial Analysis**


```{r}
# Filter data for "Sevan Lake" and "Debed river basin"
filtered_data <- data_cleaned %>%
  filter(River_Basin %in% c("Sevan Lake", "Debed river basin", "Metsamor river basin"))

# Create a visually appealing boxplot
ggplot(filtered_data, aes(x = River_Basin, y = Dissolved_Oxygen, fill = River_Basin)) +
  geom_boxplot(outlier.color = "red", outlier.size = 2) + # Highlight outliers
  labs(
    title = "Dissolved Oxygen by River Basin",
    subtitle = "Comparing Sevan Lake and Debed River Basin",
    x = "River Basin",
    y = "Dissolved Oxygen (mg/L)"
  ) +
  scale_fill_manual(values = c("Sevan Lake" = "#1f77b4", "Debed river basin" = "#ff7f0e", "Metsamor river basin"='green')) + # Custom colors
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    legend.position = "none" # Hide legend as it's clear from labels
  )


```


